

services:
  frontend:
    build: ./frontend
    container_name: frontend
    ports:
      - "5000:5000"
    environment:
      - API_GATEWAY_URL=http://api-gateway:8000
    depends_on:
      - api-gateway

  api-gateway:
    build: ./api-gateway
    container_name: api-gateway
    ports:
      - "8000:8000"
    # Las variables de entorno se actualizan para apuntar a los servicios correctos.
    # POSTS_SVC y MESSAGES_SVC ahora apuntan al servicio 'social'.
    environment:
      - USERS_SVC=http://authentication:8001
      - POSTS_SVC=http://social:8006 # Apunta al servicio social
      - ACTIVITIES_SVC=http://actividades:8003
      - MESSAGES_SVC=http://social:8006 # Apunta al servicio social
      - EVENTS_SVC=http://eventos:8005
      - SOCIAL_SVC=http://social:8006
      - JWT_SECRET=${JWT_SECRET:-your_jwt_secret}
    depends_on:
      - authentication
      - actividades
      - eventos
      - social

  # El servicio 'users' se renombra a 'authentication' y se corrige la ruta de build.
  authentication:
    build: ./services/authentication
    container_name: authentication
    ports:
      - "8001:8000"

  # Se corrige la ruta de build para el servicio 'activities'.
  actividades:
    build: ./services/actividades
    container_name: actividades
    ports:
      - "8003:8000"

  # Se corrige la ruta de build para el servicio 'events'.
  eventos:
    build: ./services/eventos
    container_name: eventos
    ports:
      - "8005:8000"

  # Se corrige la ruta de build para el servicio 'social'.
  social:
    build: ./services/social
    container_name: social
    ports:
      - "8006:8000"
