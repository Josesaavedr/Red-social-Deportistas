{% extends 'base.html' %}

{% block title %}{{ evento.titulo }} - Evento{% endblock %}

{% block content %}
<div style="max-width: 900px; margin: 0 auto;">
    <a href="{% url 'lista_eventos' %}" class="btn btn-secondary" style="margin-bottom: 1rem;">
        <i class="fas fa-arrow-left"></i> Volver a Eventos
    </a>
    
    <div class="card">
        {% if evento.imagen %}
        <img src="{{ evento.imagen.url }}" alt="{{ evento.titulo }}" style="width: 100%; max-height: 400px; object-fit: cover; border-radius: 12px; margin-bottom: 1.5rem;">
        {% endif %}
        
        <div style="display: inline-block; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600; margin-bottom: 1rem; 
            {% if evento.tipo == 'competicion' %}background: #ff6b6b; color: white;
            {% elif evento.tipo == 'entrenamiento' %}background: #4ecdc4; color: white;
            {% elif evento.tipo == 'reunion' %}background: #667eea; color: white;
            {% elif evento.tipo == 'torneo' %}background: #f093fb; color: white;
            {% else %}background: #95a5a6; color: white;{% endif %}">
            {{ evento.get_tipo_display }}
        </div>
        
        <h1 style="margin: 0.5rem 0 1rem 0;">{{ evento.titulo }}</h1>
        
        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 2px solid #e0e0e0;">
            <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.25rem;">
                {% if evento.organizador.perfil.foto_perfil %}
                    <img src="{{ evento.organizador.perfil.foto_perfil.url }}" alt="{{ evento.organizador.username }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                {% else %}
                    {{ evento.organizador.username|slice:":1"|upper }}
                {% endif %}
            </div>
            <div>
                <small style="color: #666;">Organizado por</small><br>
                <strong>
                    <a href="{% url 'perfil_usuario_detalle' evento.organizador.username %}" style="text-decoration: none; color: var(--primary-color);">
                        {{ evento.organizador.get_full_name|default:evento.organizador.username }}
                    </a>
                </strong>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                <div style="color: var(--primary-color); margin-bottom: 0.5rem;">
                    <i class="fas fa-calendar-alt" style="font-size: 1.5rem;"></i>
                </div>
                <small style="color: #666;">Fecha de Inicio</small><br>
                <strong>{{ evento.fecha_inicio|date:"d M Y, H:i" }}</strong>
            </div>
            
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                <div style="color: var(--primary-color); margin-bottom: 0.5rem;">
                    <i class="fas fa-calendar-check" style="font-size: 1.5rem;"></i>
                </div>
                <small style="color: #666;">Fecha de Fin</small><br>
                <strong>{{ evento.fecha_fin|date:"d M Y, H:i" }}</strong>
            </div>
            
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                <div style="color: var(--primary-color); margin-bottom: 0.5rem;">
                    <i class="fas fa-map-marker-alt" style="font-size: 1.5rem;"></i>
                </div>
                <small style="color: #666;">Ubicación</small><br>
                <strong>{{ evento.ubicacion }}</strong>
            </div>
            
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 10px;">
                <div style="color: var(--primary-color); margin-bottom: 0.5rem;">
                    <i class="fas fa-users" style="font-size: 1.5rem;"></i>
                </div>
                <small style="color: #666;">Participantes</small><br>
                <strong>{{ evento.participantes_count }}{% if evento.capacidad_maxima %} / {{ evento.capacidad_maxima }}{% endif %}</strong>
            </div>
        </div>
        
        <h3><i class="fas fa-info-circle"></i> Descripción</h3>
        <p style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem;">{{ evento.descripcion }}</p>
        
        {% if user.is_authenticated %}
            {% if user == evento.organizador %}
                <div class="alert alert-info">
                    <i class="fas fa-crown"></i> Eres el organizador de este evento
                </div>
            {% elif user_participa %}
                <form method="post" action="{% url 'dejar_participar_evento' evento.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger" style="width: 100%;">
                        <i class="fas fa-user-minus"></i> Dejar de Participar
                    </button>
                </form>
            {% else %}
                <form method="post" action="{% url 'participar_evento' evento.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        <i class="fas fa-user-plus"></i> Unirse al Evento
                    </button>
                </form>
            {% endif %}
        {% else %}
            <div class="alert alert-info">
                <a href="{% url 'login' %}">Inicia sesión</a> para participar en este evento
            </div>
        {% endif %}
    </div>
    
    <!-- Lista de participantes -->
    <div class="card">
        <h3><i class="fas fa-users"></i> Participantes ({{ evento.participantes_count }})</h3>
        
        {% if evento.participantes.all %}
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                {% for participante in evento.participantes.all %}
                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: #f8f9fa; border-radius: 10px;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                        {{ participante.usuario.username|slice:":1"|upper }}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <strong style="display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <a href="{% url 'perfil_usuario_detalle' participante.usuario.username %}" style="text-decoration: none; color: var(--primary-color);">
                                {{ participante.usuario.get_full_name|default:participante.usuario.username }}
                            </a>
                        </strong>
                        <small style="color: #666;">{{ participante.fecha_registro|date:"d M Y" }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="text-align: center; color: #666; padding: 2rem;">
                <i class="fas fa-user-slash"></i><br>
                Aún no hay participantes. ¡Sé el primero en unirte!
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}

